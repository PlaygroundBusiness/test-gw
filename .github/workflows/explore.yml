name: GitHub Actions Demo

on:
  push:
    branches: [master]
    tags:
      - '**'
  pull_request:
    branches: [master]

jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "ğŸ” The name of your branch is ${{ github.ref }}, shorter ${{ github.ref_name }} and your repository is ${{ github.repository }}."
      - run: echo "ğŸ” The ref type is ${{ github.ref_type }}"
      - run: echo "ğŸ” The base ref is ${{ github.base_ref }} and sha is ${{ github.sha }}"

  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Branch name
        shell: bash
        run: |
          branch_lowercase="${GITHUB_REF_NAME,,}" && normalized_branch="${branch_lowercase////-}"
          echo "$normalized_branch"
          if [ -z "$normalized_branch" ]
          then
            echo "ENV=dev requires the workflow to have a branch name!"
            exit 1
          else
            echo "::set-output name=normalized::${normalized_branch}"
          fi
      - run: echo "ğŸ‰ From pull request or branches"

  deploy-dev:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ From pull request."

  deploy-staging:
    # On master and beta branches
    if: ${{ github.event_name == 'push' && ! startsWith(github.ref, 'refs/tags/') }}
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ From master branch"

  tag:
    if: startsWith(github.ref, 'refs/tags/')
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ tag"

  deploy-production:
    needs: [tag]
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ deploy production after tag"

